<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TypePractice - Free Typing Practice</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #f8fafc;
      --text: #1e293b;
      --accent: #3b82f6;
      --correct: #10b981;
      --incorrect: #ef4444;
      --cursor: #1e293b;
      --border: #e2e8f0;
      --card-bg: #ffffff;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --font-mono: 'Courier New', monospace;
      --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    body.dark {
      --bg: #0f172a;
      --text: #f1f5f9;
      --accent: #60a5fa;
      --correct: #34d399;
      --incorrect: #f87171;
      --cursor: #f1f5f9;
      --border: #334155;
      --card-bg: #1e293b;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: var(--font-sans);
      transition: all 0.3s ease;
      min-height: 100vh;
    }

    .header {
      background: var(--card-bg);
      border-bottom: 1px solid var(--border);
      padding: 1rem 2rem;
      box-shadow: var(--shadow);
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--accent);
    }

    .badge {
      background: var(--accent);
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .controls {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 0.375rem;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
    }

    .btn-primary:hover {
      opacity: 0.9;
    }

    .btn-secondary {
      background: var(--card-bg);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--bg);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: var(--card-bg);
      padding: 1.5rem;
      border-radius: 0.5rem;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      text-align: center;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }

    .stat-label {
      color: var(--text);
      opacity: 0.7;
      font-size: 0.875rem;
    }

    .main-card {
      background: var(--card-bg);
      border-radius: 0.5rem;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      overflow: hidden;
    }

    .card-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin: 0;
    }

    .file-info {
      font-size: 0.875rem;
      color: var(--text);
      opacity: 0.7;
    }

    .tabs {
      display: flex;
      border-bottom: 1px solid var(--border);
    }

    .tab {
      padding: 1rem 1.5rem;
      cursor: pointer;
      border: none;
      background: none;
      color: var(--text);
      opacity: 0.7;
      transition: all 0.2s;
      border-bottom: 2px solid transparent;
    }

    .tab.active {
      opacity: 1;
      border-bottom-color: var(--accent);
      color: var(--accent);
    }

    .tab:hover {
      opacity: 1;
    }

    .tab-content {
      padding: 2rem;
    }

    .typing-area {
      font-family: var(--font-mono);
      font-size: 1.125rem;
      line-height: 1.8;
      min-height: 400px;
      padding: 1.5rem;
      border: 2px solid var(--border);
      border-radius: 0.5rem;
      background: var(--bg);
      margin-bottom: 1rem;
      white-space: pre-wrap;
      word-wrap: break-word;
      position: relative;
    }

    .typing-area.active {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .typing-line {
      margin-bottom: 0.5rem;
      padding: 0.25rem;
      border-radius: 0.25rem;
      transition: background-color 0.2s;
    }

    .typing-line.current {
      background: rgba(59, 130, 246, 0.1);
      border-left: 3px solid var(--accent);
      padding-left: 0.75rem;
    }

    .typing-line.completed {
      opacity: 0.6;
    }

    .char {
      position: relative;
    }

    .char.correct {
      background: var(--correct);
      color: white;
      border-radius: 2px;
    }

    .char.incorrect {
      background: var(--incorrect);
      color: white;
      border-radius: 2px;
    }

    .char.cursor {
      background: var(--cursor);
      color: var(--bg);
      animation: blink 1s infinite;
      border-radius: 2px;
    }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0.3; }
    }

    .hidden-input {
      position: absolute;
      left: -9999px;
      width: 1px;
      height: 1px;
      opacity: 0;
      pointer-events: none;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--border);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 1rem;
    }

    .progress-fill {
      height: 100%;
      background: var(--accent);
      transition: width 0.3s ease;
    }

    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      margin-top: 1rem;
    }

    .library-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-top: 1rem;
    }

    .book-card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: var(--shadow);
    }

    .book-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px -8px rgba(0, 0, 0, 0.2);
    }

    .book-cover {
      width: 100%;
      height: 250px;
      background: linear-gradient(135deg, var(--accent), var(--correct));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1rem;
      font-weight: bold;
      text-align: center;
      padding: 1rem;
    }

    .book-info {
      padding: 1rem;
    }

    .book-title {
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .book-author {
      font-size: 0.875rem;
      opacity: 0.7;
    }

    .hidden {
      display: none;
    }

    .file-input {
      display: none;
    }

    .upload-area {
      border: 2px dashed var(--border);
      border-radius: 0.5rem;
      padding: 3rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .upload-area:hover {
      border-color: var(--accent);
      background: rgba(59, 130, 246, 0.05);
    }

    .upload-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid var(--incorrect);
      color: var(--incorrect);
      padding: 1rem;
      border-radius: 0.5rem;
      margin-bottom: 1rem;
    }

    .start-hint {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid var(--accent);
      color: var(--accent);
      padding: 1rem 2rem;
      border-radius: 0.5rem;
      font-size: 1rem;
      pointer-events: none;
    }

    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }
      
      .header-content {
        flex-direction: column;
        text-align: center;
      }
      
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .typing-area {
        font-size: 1rem;
        padding: 1rem;
      }
      
      .library-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <div class="logo">
        üìö TypePractice
        <span class="badge">Free Forever</span>
      </div>
      <div class="controls">
        <input type="file" id="fileInput" class="file-input" accept=".txt,.pdf">
        <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
          üìÅ Upload File
        </button>
        <button class="btn btn-secondary" onclick="toggleDarkMode()">
          üåô Dark Mode
        </button>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="wpmValue">0</div>
        <div class="stat-label">WPM</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="accuracyValue">100%</div>
        <div class="stat-label">Accuracy</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="timeValue">0:00</div>
        <div class="stat-label">Time</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="progressValue">0/0</div>
        <div class="stat-label">Progress</div>
      </div>
    </div>

    <div class="main-card">
      <div class="card-header">
        <div>
          <h2 class="card-title" id="documentTitle">Sample Text</h2>
          <div class="file-info" id="fileInfo">6 lines, 117 words, estimated 3 minutes at 40 WPM</div>
        </div>
        <div class="controls">
          <button class="btn btn-primary" id="startBtn" onclick="startTest()">‚ñ∂Ô∏è Start</button>
          <button class="btn btn-secondary" id="pauseBtn" onclick="pauseTest()" style="display: none;">‚è∏Ô∏è Pause</button>
          <button class="btn btn-secondary" onclick="resetTest()">üîÑ Reset</button>
        </div>
      </div>

      <div class="tabs">
        <button class="tab active" onclick="showTab('practice', this)">Practice</button>
        <button class="tab" onclick="showTab('library', this)">Library</button>
        <button class="tab" onclick="showTab('stats', this)">Statistics</button>
      </div>

      <div id="practiceTab" class="tab-content">
        <div class="progress-bar">
          <div class="progress-fill" id="progressBar" style="width: 0%"></div>
        </div>
        
        <div class="typing-area" id="typingArea">
          <div class="upload-area" onclick="document.getElementById('fileInput').click()">
            <div class="upload-icon">üìÑ</div>
            <h3>Upload a file to get started</h3>
            <p>Upload a .txt or .pdf file to begin your typing practice.<br>
            Unlike other platforms, this is completely free!</p>
          </div>
        </div>

        <input type="text" class="hidden-input" id="hiddenInput" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">

        <div class="pagination" id="pagination" style="display: none;">
          <button class="btn btn-secondary" onclick="previousPage()">‚Üê Previous</button>
          <span id="pageInfo">Page 1 of 1</span>
          <button class="btn btn-secondary" onclick="nextPage()">Next ‚Üí</button>
        </div>
      </div>

      <div id="libraryTab" class="tab-content hidden">
        <h3>üìö Book Library</h3>
        <div class="library-grid">
          <div class="book-card" onclick="loadBook('pride-prejudice')">
            <div class="book-cover"> <img src="https://www.gutenberg.org/cache/epub/1342/images/cover.jpg">Pride and Prejudice</div>
            <div class="book-info">
              <div class="book-title">Pride and Prejudice</div>
              <div class="book-author">Jane Austen</div>
            </div>
          </div>
          <div class="book-card" onclick="loadBook('moby-dick')">
            <div class="book-cover">Moby Dick</div>
            <div class="book-info">
              <div class="book-title">Moby Dick</div>
              <div class="book-author">Herman Melville</div>
            </div>
          </div>
          <div class="book-card" onclick="loadBook('sherlock-holmes')">
            <div class="book-cover">The Adventures of Sherlock Holmes</div>
            <div class="book-info">
              <div class="book-title">The Adventures of Sherlock Holmes</div>
              <div class="book-author">Arthur Conan Doyle</div>
            </div>
          </div>
          <div class="book-card" onclick="loadBook('sample')">
            <div class="book-cover">Sample Text</div>
            <div class="book-info">
              <div class="book-title">Sample Text</div>
              <div class="book-author">TypePractice</div>
            </div>
          </div>
        </div>
      </div>

      <div id="statsTab" class="tab-content hidden">
        <h3>üìä Statistics</h3>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="totalChars">0</div>
            <div class="stat-label">Total Characters</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="correctChars">0</div>
            <div class="stat-label">Correct Characters</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="errorCount">0</div>
            <div class="stat-label">Errors</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="topWPM">0</div>
            <div class="stat-label">Top WPM</div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Global variables
    let currentText = '';
    let lines = [];
    let currentLine = 0;
    let currentChar = 0;
    let isActive = false;
    let startTime = null;
    let currentPage = 0;
    let linesPerPage = 8;
    let totalChars = 0;
    let correctChars = 0;
    let errors = 0;
    let topWPM = 0;
    let timer = null;
    let typedText = '';

    // Sample texts for library
    const libraryTexts = {
      'sample': `Welcome to TypePractice, the free alternative to expensive typing practice platforms.

This is a sample text to demonstrate the typing practice functionality. You can upload your own PDF or TXT files to practice with any content you want.

The application tracks your words per minute, accuracy, and provides real-time feedback as you type. You can see your progress with visual indicators for correct and incorrect characters.

Features include dark mode support, pagination for long documents, pause and resume functionality, and comprehensive statistics tracking.

Start by uploading a file using the upload button in the header, or continue practicing with this sample text.

Remember to maintain good posture while typing and take breaks to avoid strain. Happy typing!`,

      'pride-prejudice': `Pride and Prejudice
by Jane Austen

Chapter 1

It is a truth universally acknowledged, that a single man in possession of a good fortune, must be in want of a wife.

However little known the feelings or views of such a man may be on his first entering a neighbourhood, this truth is so well fixed in the minds of the surrounding families, that he is considered the rightful property of some one or other of their daughters.

"My dear Mr. Bennet," said his lady to him one day, "have you heard that Netherfield Park is let at last?"

Mr. Bennet replied that he had not.

"But it is," returned she; "for Mrs. Long has just been here, and she told me all about it."

Mr. Bennet made no answer.

"Do you not want to know who has taken it?" cried his wife impatiently.

"You want to tell me, and I have no objection to hearing it."

This was invitation enough.`,

      'moby-dick': `Moby Dick
by Herman Melville

Chapter 1
Loomings

Call me Ishmael. Some years ago‚Äînever mind how long precisely‚Äîhaving little or no money in my purse, and nothing particular to interest me on shore, I thought I would sail about a little and see the watery part of the world.

It is a way I have of driving off the spleen and regulating the circulation. Whenever I find myself growing grim about the mouth; whenever it is a damp, drizzly November in my soul; whenever I find myself involuntarily pausing before coffin warehouses, and bringing up the rear of every funeral I meet; and especially whenever my hypos get such an upper hand of me, that it requires a strong moral principle to prevent me from deliberately stepping into the street, and methodically knocking people's hats off‚Äîthen, I account it high time to get to sea as soon as possible.

This is my substitute for pistol and ball. With a philosophical flourish Cato throws himself upon his sword; I quietly take to the ship.`,

      'sherlock-holmes': `The Adventures of Sherlock Holmes
by Arthur Conan Doyle

ADVENTURE I. A SCANDAL IN BOHEMIA

I.

To Sherlock Holmes she is always THE woman. I have seldom heard him mention her under any other name. In his eyes she eclipses and predominates the whole of her sex.

It was not that he felt any emotion akin to love for Irene Adler. All emotions, and that one particularly, were abhorrent to his cold, precise but admirably balanced mind.

He was, I take it, the most perfect reasoning and observing machine that the world has seen, but as a lover he would have placed himself in a false position. He never spoke of the softer passions, save with a gibe and a sneer.

They were admirable things for the observer‚Äîexcellent for drawing the veil from men's motives and actions. But for the trained reasoner to admit such intrusions into his own delicate and finely adjusted temperament was to introduce a distracting factor which might throw a doubt upon all his mental results.`
    };

    // Initialize with sample text
    document.addEventListener('DOMContentLoaded', function() {
      loadBook('sample');
      setupEventListeners();
    });

    function setupEventListeners() {
      document.getElementById('fileInput').addEventListener('change', handleFileUpload);
      
      const hiddenInput = document.getElementById('hiddenInput');
      const typingArea = document.getElementById('typingArea');
      
      // Handle input events
      hiddenInput.addEventListener('input', handleInput);
      hiddenInput.addEventListener('keydown', handleKeyDown);
      
      // Focus management
      typingArea.addEventListener('click', focusInput);
      document.addEventListener('click', function(e) {
        if (isActive && !e.target.closest('.btn') && !e.target.closest('.tab')) {
          focusInput();
        }
      });
    }

    function focusInput() {
      if (isActive) {
        document.getElementById('hiddenInput').focus();
      }
    }

    function loadBook(bookId) {
      const text = libraryTexts[bookId] || libraryTexts['sample'];
      processText(text, getBookTitle(bookId));
      showTab('practice');
    }

    function getBookTitle(bookId) {
      const titles = {
        'sample': 'Sample Text',
        'pride-prejudice': 'Pride and Prejudice',
        'moby-dick': 'Moby Dick',
        'sherlock-holmes': 'The Adventures of Sherlock Holmes'
      };
      return titles[bookId] || 'Unknown';
    }

    function processText(text, title = 'Uploaded Text') {
      currentText = text;
      lines = text.split('\n').filter(line => line.trim() !== '');
      
      // Update document info
      document.getElementById('documentTitle').textContent = title;
      const wordCount = text.split(/\s+/).length;
      const estimatedTime = Math.ceil(wordCount / 40);
      document.getElementById('fileInfo').textContent = 
        `${lines.length} lines, ${wordCount} words, estimated ${estimatedTime} minutes at 40 WPM`;
      
      resetTest();
      renderTypingArea();
      updatePagination();
    }

    function handleFileUpload(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      
      if (file.type === 'application/pdf') {
        reader.onload = function(e) {
          processPDF(e.target.result);
        };
        reader.readAsArrayBuffer(file);
      } else {
        reader.onload = function(e) {
          processText(e.target.result, file.name);
        };
        reader.readAsText(file);
      }
    }

    async function processPDF(arrayBuffer) {
      try {
        const pdf = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
        let fullText = '';
        
        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const textContent = await page.getTextContent();
          const pageText = textContent.items.map(item => item.str).join(' ');
          fullText += pageText + '\n';
        }
        
        processText(fullText, 'PDF Document');
      } catch (error) {
        showError('Error processing PDF: ' + error.message);
      }
    }

    function renderTypingArea() {
      const typingArea = document.getElementById('typingArea');
      
      if (lines.length === 0) {
        typingArea.innerHTML = `
          <div class="upload-area" onclick="document.getElementById('fileInput').click()">
            <div class="upload-icon">üìÑ</div>
            <h3>Upload a file to get started</h3>
            <p>Upload a .txt or .pdf file to begin your typing practice.<br>
            Unlike other platforms, this is completely free!</p>
          </div>
        `;
        return;
      }

      if (!isActive && lines.length > 0) {
        typingArea.innerHTML = `
          <div class="start-hint">Click "Start" to begin typing practice</div>
          ${renderLines()}
        `;
        return;
      }

      typingArea.innerHTML = renderLines();
      typingArea.classList.toggle('active', isActive);
    }

    function renderLines() {
      if (!lines || lines.length === 0) return '';
      
      const startLine = currentPage * linesPerPage;
      const endLine = Math.min(startLine + linesPerPage, lines.length);
      const visibleLines = lines.slice(startLine, endLine);

      let html = '';
      visibleLines.forEach((line, index) => {
        const lineIndex = startLine + index;
        const isCurrentLine = lineIndex === currentLine;
        const isCompleted = lineIndex < currentLine;
        
        let lineClass = 'typing-line';
        if (isCurrentLine) lineClass += ' current';
        if (isCompleted) lineClass += ' completed';
        
        html += `<div class="${lineClass}">`;
        
        if (isCurrentLine && isActive && typedText !== undefined) {
          // Render current line with character-by-character feedback
          for (let i = 0; i < line.length; i++) {
            const char = line[i];
            let charClass = 'char';
            
            if (i < typedText.length) {
              const typedChar = typedText[i];
              charClass += typedChar === char ? ' correct' : ' incorrect';
            } else if (i === typedText.length) {
              charClass += ' cursor';
            }
            
            const displayChar = char === ' ' ? '&nbsp;' : char;
            html += `<span class="${charClass}">${displayChar}</span>`;
          }
        } else {
          html += line;
        }
        
        html += '</div>';
      });

      return html;
    }

    function handleInput(event) {
      if (!isActive || !lines || lines.length === 0 || currentLine >= lines.length) return;
      
      const input = event.target;
      typedText = input.value;
      
      // Start timer on first keystroke
      if (!startTime && typedText.length > 0) {
        startTime = Date.now();
        startTimer();
      }
      
      renderTypingArea();
      updateProgress();
      updateStatDisplay();
    }

    function handleKeyDown(event) {
      if (!isActive || !lines || lines.length === 0 || currentLine >= lines.length) return;
      
      const currentLineText = lines[currentLine];
      if (!currentLineText) return;
      
      if (event.key === 'Enter') {
        event.preventDefault();
        
        // Calculate statistics for the line
        for (let i = 0; i < Math.max(typedText.length, currentLineText.length); i++) {
          totalChars++;
          if (i < typedText.length && i < currentLineText.length && typedText[i] === currentLineText[i]) {
            correctChars++;
          } else {
            errors++;
          }
        }
        
        // Move to next line
        moveToNextLine();
      }
    }

    function moveToNextLine() {
      currentLine++;
      typedText = '';
      document.getElementById('hiddenInput').value = '';
      
      // Check if test is completed
      if (currentLine >= lines.length) {
        completeTest();
        return;
      }
      
      // Auto-navigate to next page if needed
      const newPage = Math.floor(currentLine / linesPerPage);
      if (newPage !== currentPage) {
        currentPage = newPage;
        updatePagination();
      }
      
      renderTypingArea();
      updateProgress();
    }

    function updateStatDisplay() {
      // Safety checks
      if (!lines || lines.length === 0 || currentLine >= lines.length) return;
      
      // Calculate current line statistics
      const currentLineText = lines[currentLine] || '';
      let currentCorrect = 0;
      let currentTotal = typedText ? typedText.length : 0;
      
      for (let i = 0; i < currentTotal; i++) {
        if (i < currentLineText.length && typedText[i] === currentLineText[i]) {
          currentCorrect++;
        }
      }
      
      // Calculate WPM
      const elapsed = startTime ? (Date.now() - startTime) / 1000 / 60 : 0;
      const totalCorrectChars = correctChars + currentCorrect;
      const wpm = elapsed > 0 ? Math.round((totalCorrectChars / 5) / elapsed) : 0;
      
      // Calculate accuracy
      const totalTypedChars = totalChars + currentTotal;
      const accuracy = totalTypedChars > 0 ? Math.round(((correctChars + currentCorrect) / totalTypedChars) * 100) : 100;
      
      // Update top WPM
      if (wpm > topWPM) {
        topWPM = wpm;
        document.getElementById("topWPM").textContent = topWPM;
      }
      
      // Update display
      document.getElementById("wpmValue").textContent = wpm;
      document.getElementById("accuracyValue").textContent = accuracy + "%";
      document.getElementById("totalChars").textContent = totalTypedChars;
      document.getElementById("correctChars").textContent = totalCorrectChars;
      document.getElementById("errorCount").textContent = errors + (currentTotal - currentCorrect);
    }

    function updateProgress() {
      const progress = lines.length > 0 ? (currentLine / lines.length) * 100 : 0;
      document.getElementById("progressBar").style.width = progress + "%";
      document.getElementById("progressValue").textContent = `${currentLine}/${lines.length}`;
    }

    function startTimer() {
      timer = setInterval(() => {
        if (!startTime) return;
        
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        const minutes = Math.floor(elapsed / 60);
        const seconds = elapsed % 60;
        document.getElementById("timeValue").textContent = 
          `${minutes}:${seconds.toString().padStart(2, "0")}`;
        
        updateStatDisplay();
      }, 1000);
    }

    function startTest() {
      if (lines.length === 0) return;
      
      isActive = true;
      document.getElementById("startBtn").style.display = "none";
      document.getElementById("pauseBtn").style.display = "inline-flex";
      
      renderTypingArea();
      focusInput();
    }

    function pauseTest() {
      isActive = false;
      document.getElementById("startBtn").style.display = "inline-flex";
      document.getElementById("pauseBtn").style.display = "none";
      
      if (timer) {
        clearInterval(timer);
        timer = null;
      }
      
      renderTypingArea();
    }

    function resetTest() {
      isActive = false;
      currentLine = 0;
      currentChar = 0;
      currentPage = 0;
      startTime = null;
      totalChars = 0;
      correctChars = 0;
      errors = 0;
      typedText = '';
      
      document.getElementById("hiddenInput").value = "";
      document.getElementById("startBtn").style.display = "inline-flex";
      document.getElementById("pauseBtn").style.display = "none";
      document.getElementById("timeValue").textContent = "0:00";
      document.getElementById("wpmValue").textContent = "0";
      document.getElementById("accuracyValue").textContent = "100%";
      
      if (timer) {
        clearInterval(timer);
        timer = null;
      }
      
      renderTypingArea();
      updateProgress();
      updatePagination();
    }

    function completeTest() {
      isActive = false;
      document.getElementById("startBtn").style.display = "inline-flex";
      document.getElementById("pauseBtn").style.display = "none";
      
      if (timer) {
        clearInterval(timer);
        timer = null;
      }
      
      alert("Congratulations! You have completed the typing test!");
    }

    function previousPage() {
      if (currentPage > 0) {
        currentPage--;
        renderTypingArea();
        updatePagination();
      }
    }

    function nextPage() {
      const maxPage = Math.ceil(lines.length / linesPerPage) - 1;
      if (currentPage < maxPage) {
        currentPage++;
        renderTypingArea();
        updatePagination();
      }
    }

    function updatePagination() {
      const pagination = document.getElementById("pagination");
      const pageInfo = document.getElementById("pageInfo");
      
      if (lines.length <= linesPerPage) {
        pagination.style.display = "none";
        return;
      }
      
      pagination.style.display = "flex";
      const totalPages = Math.ceil(lines.length / linesPerPage);
      pageInfo.textContent = `Page ${currentPage + 1} of ${totalPages}`;
    }

    function showTab(tabName, targetElement) {
      // Hide all tabs
      document.querySelectorAll(".tab-content").forEach(tab => {
        tab.classList.add("hidden");
      });
      
      // Remove active class from all tab buttons
      document.querySelectorAll(".tab").forEach(tab => {
        tab.classList.remove("active");
      });
      
      // Show selected tab
      document.getElementById(tabName + "Tab").classList.remove("hidden");
      
      // Add active class to clicked tab
      if (targetElement) {
        targetElement.classList.add("active");
      } else {
        // Fallback: find the tab button by text content
        document.querySelectorAll(".tab").forEach(tab => {
          if (tab.textContent.toLowerCase().includes(tabName.toLowerCase())) {
            tab.classList.add("active");
          }
        });
      }
    }

    function toggleDarkMode() {
      document.body.classList.toggle("dark");
      const isDark = document.body.classList.contains("dark");
      
      const btn = event.target;
      btn.textContent = isDark ? "‚òÄÔ∏è Light Mode" : "üåô Dark Mode";
    }

    function showError(message) {
      const typingArea = document.getElementById("typingArea");
      typingArea.innerHTML = `
        <div class="error">
          <strong>Error:</strong> ${message}
        </div>
        <div class="upload-area" onclick="document.getElementById('fileInput').click()">
          <div class="upload-icon">üìÑ</div>
          <h3>Try uploading another file</h3>
          <p>Upload a .txt or .pdf file to begin your typing practice.</p>
        </div>
      `;
    }
  </script>
</body>
</html>
